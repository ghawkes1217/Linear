<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Linear Algebra: Complete Solution to the System Ax=b</title>

<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]},
  }
</script>

<!-- The following adds MathJax to render LaTeX notation -->
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script>

<link rel="stylesheet" href="../styles.css">

<script src="../site-scripts.js"></script>

<style type="text/css">
  #blank {
    position: relative;}

  #outer {
    position: absolute;
    left: 0px;
    top: 90px;
    background-color: white;
    text-align: center;}

  #equations {
    position: absolute;
    height: 300px;
    width: 350px;
    left: 800px;
    top: 90px;
    background-color: black;
    /*-webkit-text-stroke: 0.2px silver;*/
    text-align: center;}
  
  #line {
    position: absolute;
    height: 280px;
    width: 5px;
    left: 400px;
    top: 0px;
    background-color: black;}

  #try {
    position: absolute;
    height: 30px;
    width: 90px;
    left: 290px;
    top: 10px;
    background-color: white;
    text-align: center;}

  .center {
    text-align: center;
    font-size: 30px;}

  .inp {
    position: absolute;
    left: 5px;
    height: 40px;
    width: 55px;
    background-color: white;}

  .scalarInput {
    position: absolute;
    background-color: lightyellow;
    left: 5px;
    font-size: 22px;
    width: 55px;
    height: 40px;}

  .separator {
    top: 0px;
    position: absolute;
    background-color: black;
    width: 10px;}

  .multiplyButton {
    font-size: 22px;
    position: absolute;
    height: 46px;
    width: 28px;
    left: 70px;
    background-color: silver}

  .matrixRow {
    position: absolute;
    height: 55px;
    left: 100px;
    opacity: 0.8;}

  .matrixColumn {
    position: absolute;
    height: 45px;
    width: 75px;
    top: 10px;
    opacity: 0.8;
    background-color: #FFFFFF10;}

  #solution_box {
    position: absolute;
    height: 225px;
    width: 195px;
    left: 900px;
    top: 900px;
    background-color: white;
    border: 9px solid black;
    text-align: center}

  #solutions1 {
    position: absolute;
    height: 80px;
    width: 95px;
    left: 0px;
    top: 30px;
    background-color: white;
    text-align: center}

  #solutions2 {
    position: absolute;
    height: 80px;
    width: 95px;
    left: 95px;
    top: 30px;
    background-color: white;
    text-align: center}

  #difficulty {
    position: absolute;
    height: 30px;
    width: 390px;
    left: 490px;
    top: 0px;
    background-color: white;
    text-align: center;}

  #diff_buttons {
    position: absolute;
    height: 30px;
    width: 390px;
    left: 490px;
    top: 30px;
    background-color: white;
    text-align: center;}

  #score {
    position: absolute;
    height: 220px;
    width: 90px;
    left: 1200px;
    top: 0px;
    background-color: white;
    text-align: center;}

  .systems {
    display: flex;
    justify-content: space-around;
  }
</style>
</head>

<body>

<h2><center>Module: Complete Solution to the System $Ax=b$</center></h2>

<div class="introduction">
  <p>
    Take a look at these three different systems of 3 linear equations:
    <ul class='systems'>
      <li> <b>System 1</b>
        $$\begin{aligned}
        x+y &= 1,\\
        y+z &= 2,\\
        x+z &= 3.\\ 
        \end{aligned}$$
      </li>
      <li> <b>System 2</b>
        $$\begin{aligned}
        x+y &= 1,\\
        y+z &= 2,\\
        x-z &= -1.\\ 
        \end{aligned}$$
      </li>
      <li> <b>System 3</b>
        $$\begin{aligned}
        x+y &= 1,\\
        y+z &= 2,\\
        x-z &= 3.\\ 
        \end{aligned}$$
      </li>
    </ul>
  </p>

  <p>
    In System 1, we can figure out the values of $x,y,z$ by first adding all three equations to produce $2x+2y+2z=6$, so that $x+y+z=3$. Subtracting each of the three equations from this one respectively gives $z=2, x=1, y=0$. This gives precisely the only set of solutions that solves System 1.
  </p>

  <p>
    Next, for System 2, we may infer the third equation by subtraction the first by the second, that is, 
    $$x-z = (x+y)-(y+z) = 1-2 =-1,$$
    This gives us some freedom to vary the value of $y$, so that the values of $x$ and $z$ can be inferred from the first two equations. 
    For example, we may have $y=0$ and thus that $x=1-y=1-0=1$ and $z=2-y=2-0=2$.
    If instead, we had chosen $y=1$, we would have $x=1-y=1-1=0$ and $z=2-y=2-1=1$.
    Both cases (and in fact, many more) are valid sets of solutions to this system.
  </p>

  <p>
    Finally, within System 3, we could similarly subtract the first equation by the second to obtain $x-z=-1$.
    However, this clearly contradicts the third equation, which says that $x-z=3$ as well.
    In this case, there are no values of $x$, $y$ and $z$ that satisfy all of these equations.
  </p>
  
  <p>
    Although these three systems are systems of 3 linear equations in 3 variables, their behavior all differ:
    <ul>
      <li> One system yields a unique set of solutions,</li>
      <li> Another system yields more than one consistent set of solutions,</li>
      <li> Yet another system has no consistent set of solutions due to an inherent contradiction.</li>
    </ul>
  </p>
  
  <p> 
    How do we distinguish these behaviors, you ask? For starters, consider the following framework. Suppose you have a system of $m$ linear equations in variables $x_1, x_2, x_3 \ldots, x_n$

    $$\begin{alignedat}{5}
      a_{1,1} x_1 & + a_{1,2} x_2 & + \ldots & + a_{1,n} x_n & = c_1,\\
      a_{2,1} x_1 & + a_{2,2} x_2 & + \ldots & + a_{2,n} x_n & = c_2,\\
      \vdots      &               &   \vdots &               & \\
      a_{m,1} x_1 & + a_{m,2} x_2 & + \ldots & + a_{m,n} x_n & = c_m,\\
    \end{alignedat}$$

    with real constants $a_{i,j}$ and $c_i$, where $1\leq i\leq m$, $1\leq j\leq n$.
    We may compress this as a matrix equation $Ax=b$ by setting 
    $$A = 
    \begin{bmatrix}
      a_{1,1} & a_{1,2} & \ldots & a_{1,n}\\
      a_{2,1} & a_{2,2} & \ldots & a_{2,n}\\
      \vdots  & \vdots  & \ddots & \vdots\\
      a_{m,1} & a_{m,2} & \ldots & a_{m,n}\\
    \end{bmatrix},\quad 
    x = \begin{bmatrix} x_1\\ x_2\\ \vdots\\ x_n \end{bmatrix},\quad 
    b = \begin{bmatrix} c_1\\ c_2\\ \vdots\\ c_m \end{bmatrix}.$$
    
    We may compute the r.r.e.f. of the augmented matrix $M=[A\;|\; b\;]$ to simplify our viewpoint of the same system. Based on the r.r.e.f. $M'$ of $M$, we could deduce three distinct behaviors:
    <ul>
      <li> 
        All columns of the left part of $M'$ contain a pivot. In this case, the values of each variable is unique and we may read off each of the values from the rows of $M'$.

        As an example, the augmented matrix associated to System 1 has its r.r.e.f. to be
      
        $$ M' = \begin{array}{c}
        \begin{array}{llll}
        \hspace{-5pt} x & y & z & \\
        \end{array}\\
        \left[\begin{array}{ccc|c}
        1 & 0 & 0 & 1\\
        0 & 1 & 0 & 0\\
        0 & 0 & 1 & 2\\
        \end{array}\right]\\
        \end{array},$$
        therefore, we have $(x,y,z)=(1,0,2)$.
        This system is said to be <b><em>consistent</em></b> as we have a solution set.
      </li>
      <li> 
        Not all columns on the left part of $M'$ contain a pivot; furthermore, whenever there is a row of zeros on the left part of $M'$, it is followed by a 0. In this case, each column containing a pivot corresponds to a <b><em>pivot variable</b></em> whereas each column that does not contain a pivot corresponds to a <b><em>free variable</b></em>. 

        For instance, the augmented matrix associated to System 2 has its r.r.e.f. to be
      
        $$ M' = \begin{array}{c}
        \begin{array}{llll}
        \hspace{-20pt} x & \hspace{-15pt} y & \hspace{-5pt} z & \\
        \end{array}\\
        \left[\begin{array}{ccc|c}
        1 & 0 & -1 & -1\\
        0 & 1 & 1 & 2\\
        0 & 0 & 0 & 0\\
        \end{array}\right]\\
        \end{array}.$$

        In this case, $x$ and $y$ are pivot variables, whereas $z$ is a free variable. 
        If we set $z=t$ for some real value $t$, we have $x=-1+z=-1+t$ and $y=2-z=2-t$, so that $(x,y,z)=(-1+t,2-t,t)$.

        In general, note that there are multiple valid sets of solutions that can be obtained by varying the values of each free variable. 
        Similar to the previous case, this system is said to be <b><em>consistent</em></b> as we also have at least one solution set.
      </li>
      <li> 
        Not all on the left part of $M'$ contain a pivot; furthermore, there is a row of zeros on the left part of $M'$ but is followed by a nonzero entry.

        In this case, there is no consistent set of values that can be assigned to each variable. We would have no solution here. 

        For instance, the augmented matrix associated to System 3 has its r.r.e.f. to be
      
        $$ M' = \begin{array}{c}
        \begin{array}{llll}
        \hspace{-15pt}x & \hspace{-10pt} y & z & \\
        \end{array}\\
        \left[\begin{array}{ccc|c}
        1 & 0 & -1 & 0\\
        0 & 1 & 1 & 0\\
        0 & 0 & 0 & 1\\
        \end{array}\right]\\
        \end{array}.$$
        Now, as the last row is a bunch of zeros followed by a 1, we cannot find a set of values for $x,y,z$ that satisfy the original system of equations.
        This system is said to be <b><em>inconsistent</em></b>.
      </li>
    </ul>
  </p>
</div>
  
<div class="instruction">
  <p>
    For this module, your task is to perform the following:
    <ul>
      <li>
        Determine whether or not a given system of equations is consistent.
      </li>
      <li>
        Determine the nature of the nullspace associated to a given system of equations.
      </li>
      <li>
        Find a set of solutions given another set of solutions when multiple solutions exist.
      </li>
    </ul>
  </p>

  <p>
    You may perform row operations onto the matrix shown below:
    <ul>
      <li>
        To swap two rows, drag one of them and release it onto another, 
      </li>
      <li>
        To scale a row, enter a rational number (of the form $a/b$) next to that row and click on the $\times$ symbol next to it,
      </li>
      <li>
        To add a multiple of one row to another, enter a rational number next to the row to be multiplied, then drag release it onto the target row.
      </li>
    </ul>
    The result is always shown on the screen to the right of the matrix. 
    Feel free to hit 'Undo' if you would like to backtrack some performed operations.
  </p>
</div>

<div id="blank">
  <div id="score">
  </div>

  <div id="submit" style="left: 10px; top:20px; position:absolute">
    <button onclick="compare()"> Submit </button>
  </div>

  <div id="undo" style="left:10px; top:50px; position:absolute">
    <button  onclick="revert()">Undo</button>
  </div>
  
  <!--<div id="diff_buttons">
    <button style="background-color:white" onclick="diff(1)">&#8593</button>
    <button style="background-color:white" onclick="diff(-1)">&#8595</button>
  </div>
  
  <div id="difficulty">
    Difficulty Level: 1
  </div>-->
  
  <div id="selection" style="position:absolute; top:30px">
  </div>

  <div id="equations">
  </div>

  <div id="outer">
  </div>
</div>
  

<script type="text/javascript">
  quests = 
  [
    "Is this a consistent or an inconsistent system of linear equations?", // Can be consistent or incosistent
    "Which of these two types does this system of linear equations belong to?", // Can be consistent or inconsistent
    "Great, now, find a set of values for each variable that satisfies the following system of linear equation. If there is none, click on 'No Solution' instead.", // Solution set need to exist
    "As a follow up, is there another set of solutions to the same system? If so, click on 'Multiple Solutions', otherwise, click on 'Unique Solution'.", // Can have unique or multiple solutions
    "Nice, can you find a set of values satisfying this system of linear equation?", // Solution set need to exist
    "Can there be another set of solutions to the same system?", // Can have unique or multiple solutions
    "Is there a nonzero vector that lies in the associated nullspace of this system? Click on 'None' if there is none.",
    "Does there exist one or many sets of solution to this system?",
    "Alright, is there a nonzero vector that lies in the associated nullspace of this system?",
    "Does there exist one or many sets of solution to this system?",
    "Let's switch gears. You are given a set of solutions to the following system. Can you use it to find another set of solutions?",
    "Good, given this set of solution, can you use it to find another set of solutions?",
    "Awesome!"
  ]
</script>

<script type="text/javascript">
  // Returns the gcd of two integers
  function gcd(a, b){
    if (a == 0 && b == 0){
      throw "Both integers cannot be both zero."
      return }
    if (a == 0){
      return Math.abs(b)}
    if (b == 0){
      return Math.abs(a)}
    if (b < 0){
      return gcd(a, -b)}
    if (a < 0){
      return gcd(-a, b)}
    return gcd(b, a%b)
  }

  // Defines a class of rational numbers
  class RationalNumber{
    constructor(a, b){
      if (b < 0){
        a = -a
        b = -b}
      let d = gcd(a,b)
      this.numerator = a/d
      this.denominator = b/d}

    toString(){
      if (this.denominator==1){
        return String(this.numerator)}
      return String(this.numerator)+"/"+String(this.denominator)}

    equals(that){
      return that instanceof RationalNumber && 
             this.numerator == that.numerator && 
             this.denominator == that.denominator
    }

    doesNotEqual(that){
      return !this.equals(that)}

    greaterThan(that){
      return this.numerator*that.denominator > this.denominator*that.numerator}

    greaterThanOrEquals(that){
      return this.numerator*that.denominator >= this.denominator*that.numerator}

    lessThan(that){
      return !this.greaterOrEquals(that)}

    lessThanOrEquals(that){
      return !this.greaterThan(that)}

    add(that){
      let m = this.numerator*that.denominator + this.denominator*that.numerator
      let n = this.denominator*that.denominator
      return new RationalNumber(m, n)}

    negate(){
      return new RationalNumber(-this.numerator, this.denominator)}

    subtract(that){
      return this.add(that.negate())}

    multiply(that){
      let m = this.numerator*that.numerator
      let n = this.denominator*that.denominator
      return new RationalNumber(m, n)}

    invert(){
      if (this.numerator==0){
        alert("One does not simply divide by zero.")}
      return new RationalNumber(this.denominator, this.numerator)}

    divide(that){
      return this.multiply(that.invert())}
  }

  function parseRational(input){
    // if input is already an instance of a rational number, do nothing
    if (input instanceof RationalNumber){
      return input}

    // if input is an integer, return is as a rational number
    if (!isNaN(input) && parseInt(input)==input){
      return new RationalNumber(input, 1)}

    n = input.length
    let numberExist = [false, false]
    let index = -1
    for (let i=0; i<n; i++){
      if (input[i] == '-'){
        if (i!=index+1 || i==n-1){
          alert("This is not a rational number.")
          return } } 
      else if (input[i] == '/'){
        if (i==0 || i==n-1 || index>0){
          alert("This is not a rational number.")
          return }
        index = i}
      else if (isNaN(input[i])){
        alert("This is not a rational number.")
        return } 
      else {
        if (!numberExist[0] && index==-1){
          numberExist[0] = true} 
        else if (!numberExist[1] && index > 0){
            numberExist[1] = true} }
    }

    if(index==-1){
      if (!numberExist[0]){
        alert("This is not a rational number.")
        return }
      let a = parseInt(input)
      return new RationalNumber(a, 1)}

    if (!numberExist[0] || !numberExist[1]){
      alert("This is not a rational number.")
      return }
    let a = parseInt(input.slice(0, index))
    let b = parseInt(input.slice(index+1, n))
    return new RationalNumber(a, b)
  }

  // Defines a class of rational-valued matrices
  class RationalMatrix extends Array{
    constructor(M){
      for (let i=1; i<M.length; i++){
        if (M[i].length != M[0].length){
          alert("Given array must be rectangular.")
          throw new Error("Given array must be rectangular.")
        }
      }

      let matrixM = []
      for (let i=0; i<M.length; i++){
        let row = []
        for (let j=0; j<M[0].length; j++){
          let entry = parseRational(M[i][j])
          if (entry == undefined){
            alert("Entry is not a rational number.")
            throw new Error("Entry is not a rational number.")
          }
          row.push(entry)
        }
        matrixM.push(row)
      }
      super(...matrixM)
      this.rowDim = matrixM.length
      this.colDim = matrixM[0].length
      }

    toString(){
      let string = "["
      for (let i=0; i<this.length; i++){
        string += "["
        for (let j=0; j<this[0].length; j++){
          string += this[i][j].toString()
          if (j < this[i].length-1){
            string += ", "
          }
        }
        string += "]"
        if (i < this.length-1){
          string += ", "}
      }
      string += "]"
      return string
    }

    LaTeX(){
      let string = "\\begin{bmatrix} \n"
      for (let i=0; i<this.rowDim; i++){
        for (let j=0; j<this.colDim; j++){
          string += String(this[i][j]) + " "
          if (j < this.colDim-1){
            string += "& "}
        } 
        if (i < this.rowDim-1){
          string += "\\\\\n"}
      }
      string += "\n\\end{bmatrix}"
      return string
    }

    equals(that){
      if (!that instanceof RationalMatrix){
        return false}
      if (this.rowDim != that.rowDim || this[0].colDim != that[0].colDim){
        return false}
      for (let i=0; i<this.rowDim; i++){
        for (let j=0; j<this.colDim; j++){
          if (this[i][j].doesNotEqual(that[i][j])){
            return false}
        }
      }
      return true
    }

    doesNotEqual(that){
      return !this.equals(that)}

    transpose(){
      let matrixM = []
      for (let j=0; j<this.colDim; j++){
        row = []
        for (let i=0; i<this.rowDim; i++){
          row.push(this[i][j])
        }
        matrixM.push(row)
      }
      return new RationalMatrix(matrixM)
    }

    add(that){
      let matrixM = []
      for (let i=0; i<this.rowDim; i++){
        row = []
        for (let j=0; j<this.colDim; j++){
          row.push(this[i][j].add(that[i][j]))
        }
        matrixM.push(row)
      }
      return new RationalMatrix(matrixM)
    }

    negate(){
      let matrixM = []
      for (let i=0; i<this.rowDim; i++){
        row = []
        for (let j=0; j<this.colDim; j++){
          row.push(this[i][j].negate())
        }
        matrixM.push(row)
      }
      return new RationalMatrix(matrixM)
    }

    subtract(that){
      return this.add(that.negate())}

    multiply(that){
      if (this.colDim != that.rowDim){
        alert("Dimensions of matrices must agree.")
        throw new Error("Dimensions of matrices must agree.")
      }

      let matrixM = []
      for (let i=0; i<this.rowDim; i++){
        row = []
        for (let j=0; j<that.colDim; j++){
          let sum = parseRational("0")
          for (let k=0; k<this.colDim; k++){
            sum = sum.add(this[i][k].multiply(that[k][j]))}
          row.push(sum)
        }
        matrixM.push(row)
      }
      return new RationalMatrix(matrixM)
    }

    swapRows(ithRow, jthRow){
      if (ithRow>=this.rowDim || jthRow>=this.rowDim){
        throw new Error("Row index out of reach.")}
      let matrixM = []
      for (let k=0; k<this.rowDim; k++){
        if (k!=ithRow && k!=jthRow){
          matrixM.push(this[k])}
        else {
          matrixM.push(this[ithRow+jthRow-k])}
      }
      return new RationalMatrix(matrixM)
    }

    scaleRows(ithRow, cScalar){
      if (ithRow >= this.rowDim){
        throw new Error("Row index out of reach.")}
      let matrixM = []
      for (let k=0; k<this.rowDim; k++){
        if (k != ithRow){
          matrixM.push(this[k])}
        else {
          row = []
          for (let h=0; h<this.colDim; h++){
            row.push(this[k][h].multiply(parseRational(cScalar)))
          }
          matrixM.push(row)
        }
      }
      return new RationalMatrix(matrixM)
    }

    addRows(ithRow, jthRow, cScalar){
      if (ithRow>=this.rowDim || jthRow>=this.rowDim){
        throw new Error("Row index out of reach.")}
      let matrixM = []
      for (let k=0; k<this.rowDim; k++){
        if (k != jthRow){
          matrixM.push(this[k])}
        else {
          row = []
          for (let h=0; h<this.colDim; h++){
            let entry = this[k][h].add(this[ithRow][h].multiply(parseRational(cScalar)))
            row.push(entry)
          }
          matrixM.push(row)
        }
      }
      return new RationalMatrix(matrixM)
    }

    limitColumns(start, end){
      n = this.colDim
      if (start >= end){
        throw new Error("Starting index must be smaller than ending index.")}
      if (start > n || end <= 1){
        throw new Error("Column indices should range between 1 and " + n + ".")}
      if (end > n){
        return this.limitColumns(start-1, n)}
      if (start < 1){
        return this.limitColumns(0, end)}
      let M = []
      for (let i=0; i<this.rowDim; i++){
        M.push(this[i].slice(start-1, end))}
      return new RationalMatrix(M)
    }
  }

  // This class structures a string as a response string that can be compared with other objects 
  class ResponseString{
    constructor(string){
      this.response = string}

    toString(){
      return String(this.response)}

    equals(that){
      return that instanceof ResponseString && this.response == that.response}

    doesNotEqual(that){
      return !this.equals(that)}
  }
</script>

<script type="text/javascript">
  // Returns an integer in the interval [low, high]
  function generateInteger(low, high){
    difference = high - low + 1
    return low + Math.floor(difference * Math.random())
  }

  function generatePermutation(n){
    array = []
    for (let i=0; i<n; i++){
      array.push(i)
    }

    for (let i=0; i<n-1; i++){
      j = i + generateInteger(0, n-1-i)
      temp = array[i]
      array[i] = array[j]
      array[j] = temp
    }
    return array
  }

  function generateRationalNumber(den, maxRange){
    maxNum = maxRange * den
    num = generateInteger(-maxNum, maxNum)
    return new RationalNumber(num, den)
  }

  function generateRationalTuple(rank){
    scalars = []
    den = generateInteger(1, 10)
    for (let i=0; i<rank; i++){
      scalars.push(generateRationalNumber(den, 5))
    }
    return scalars
  }

  function linearCombination(rows, scalars){
    n = rows[0].length
    vector = []
    for (let j=0; j<n; j++){
      entry = new RationalNumber(0, 1)
      for (let i=0; i<rows.length; i++){
        entry = entry.add(scalars[i].multiply(rows[i][j]))
      }
      vector.push(entry)
    }
    return vector
  }

  function generateRationalMatrixPair(rowNum, colNum, rank){
    generatingRows = []
    var limit = rank<rowNum ? rank : rowNum

    for (let i=0; i<limit; i++){
      row = []
      den = generateInteger(1, 10)
      for (let j=0; j<colNum; j++){
        row.push(generateRationalNumber(den, 5))
      }
      generatingRows.push(row)
    }

    coordinateVectors = []
    for (let i=0; i<limit; i++){
      vector = []
      for (let j=0; j<limit; j++){
        q = j==i ? new RationalNumber(1, 1) : new RationalNumber(0, 1)
        vector.push(q)
      }
      coordinateVectors.push(vector)
    }

    for (let i=limit; i<rowNum; i++){
      coordinateVectors.push(generateRationalTuple(limit)) 
    }
    permutation = generatePermutation(rowNum) 

    A = []
    B = []
    for (let i=0; i<rowNum; i++){
      m = permutation[i]
      if (m < limit){
        A.push(generatingRows[m])}
      else {
        A.push(linearCombination(generatingRows, coordinateVectors[m]))}
      B.push(coordinateVectors[m])
    }
    return [A, B]
  }
</script>

<script type="text/javascript">
  function compare(){
    var correct=1
    for (var i=0; i<numCols-1; i++){
      var free=1
      if (Pivots[i]==1 && sum(Pivots,0,i+1)<=numRows){
        free=0}
      var color=document.getElementById(variables[i]).style.backgroundColor
      if (color=="white" && free==1){
        correct=0}
      if (color=="grey" && free==0){
        correct=0}
    }

    Current=get_entries()
    same=1

    for (var i=0; i<numRows; i++){
      for (var j=0; j<numCols; j++){
      if (Initial[i][j][0]!=rationalize(Current[i][j].innerHTML)[0] || Initial[i][j][1]!=rationalize(Current[i][j].innerHTML)[1]){
        same=0 }
      }
    }
    if (same==1 && correct==1){
      alert("Good Job!")
      grades[difficulty-1][0]+=1
      diff(1)
      initialize()
      sql_record(Module_Number)
    }

    if (same==0 || correct==0){
      if (same==0 && correct==1){
        alert("You're not quite to RREF yet!")}
      if (same==1 && correct==0){
        alert("That's the correct RREF but you haven't chosen the correct free variables.")}
      if (same==0 && correct==0){
        alert("Oops-that's not the RREF and those aren't the free variables.")}
      grades[difficulty-1][1]+=1
      sql_record(Module_Number)
    }
  }

  function selection(){
    var selection=document.getElementById("selection")
    while (selection.firstChild){
      selection.removeChild(selection.lastChild)}
    for (var i=0; i<numCols-1; i++){
        var variable=document.createElement('button')
        variable.style.left=(75*i+110)+"px"
        variable.style.position="absolute"
        variable.style.backgroundColor="white"
        variable.id=variables[i]
        variable.name=variables[i]
        variable.innerHTML=variables[i]
        variable.style.fontSize="22px"
        variable.style.width="55px"
        variable.style.height="40px"
        //variable.addEventListener("click", function (){selectBox()}, false)
        selection.appendChild(variable)
    }
  }

  // This function toggles selected variables
  function selectBox(){
    var variable=document.activeElement
    var newcolor=''
    if (variable.style.backgroundColor=="silver"){
      newcolor="white"}
    if (variable.style.backgroundColor=="white"){
      newcolor="silver"}
    variable.style.backgroundColor=newcolor
  }

  function equations(){
    var eBox=document.getElementById("equations")
    eBox.style.left=75*numCols+150+"px"
    eBox.style.height=75*numRows-10+"px"
  }

  function create_matrix(){
    var outer=document.getElementById('outer')
    outer.value=[numRows,numCols]
    outer.style.height=75*6+50+"px"
    outer.style.width=75*numCols+90+"px"
    while (outer.firstChild) {
      outer.removeChild(outer.lastChild)}

    //separator for augmented matrix
    var augmented=document.createElement('div')
    augmented.className = 'separator'
    augmented.style.left=75*numCols+15+"px"
    augmented.style.height=75*numRows-20+"px"
    outer.appendChild(augmented)

    //inputs
    for (var i=0; i<numRows; i++){
      var inp = document.createElement('input')
      inp.type = "text"
      inp.name = i
      inp.id = "in"+(i+1)

      inp.className = 'scalarInput'
      inp.style.top = (75*i+5)+"px"

      outer.appendChild(inp)
    }

    //switches
    for (var i=0; i<numRows-1; i++){
      var swit=document.createElement('button')
      swit.id="switch"+(i+1)+(i+2)
      swit.addEventListener("click", function (){switchAdjacentRows()},false)
      swit.style.position="absolute"
      swit.style.backgroundColor="white"
      swit.style.height="20px"
      swit.style.width=numCols*75+"px"
      swit.style.left="100px"
      swit.style.top=(75*i+55)+"px"
      swit.name=i
      outer.appendChild(swit)
    }

    //multipliers
    for (var i=0; i<numRows; i++){
      var multi = document.createElement('button')
      multi.id = "mult"+(i+1)
      multi.name = i
      multi.innerHTML = "&times"
      multi.addEventListener("click",function() {mult()},false)
      multi.style.top = (75*i+5)+"px"
      multi.className = 'multiplyButton'
      outer.appendChild(multi)
    }

    //rows
    var Colors = colorList
    //var outer = document.getElementById("outer")
    for (var i=0; i<numRows; i++){
      var row=document.createElement('div')
      row.className = 'matrixRow'
      row.style.width=(numCols*75)+"px"
      row.style.top=(75*i)+"px"
      row.style.backgroundColor=Colors[i]
      row.id=Colors[i]+"tip"

      outer.appendChild(row)

      
      for (var j=0; j<numCols; j++){
        var col=document.createElement('div')
        col.className = 'matrixColumn center'
        col.style.left=(75*j)+"px"
        col.style.opacity=0.8
        col.id=colorList[i]+(j+1)

        row.appendChild(col)
      }
    }
  }

  // This function displays the matrix according to the difficulty level
  function diff(k){
    if (0<difficulty+k && difficulty+k<11){
      difficulty += k
      numRows = Math.round(2.5+difficulty/5+Math.random()*difficulty/5)
      numCols = Math.round(3.7+difficulty/4+Math.random()*difficulty/4)
      page += k
      initialize()
    }

    if (difficulty==10){
      //score()
    }
    document.getElementById("difficulty").innerText='Difficulty Level: ' + difficulty
  }

  // This function retrieves entries of the augmented matrix
  function get_entries(){
    var Col=[]
    for (var i=0; i<numRows; i++){
      Col.push([])
      for (var j=0; j<numCols; j++){
        Col[i].push(document.getElementById(colorList[i]+(j+1)))
      }
    }
    return(Col)
  }

  function rationalize(fraction){
    if (fraction.includes('.')){
      numerator=parseFloat(fraction)
      denominator=1

      while (Number.isInteger(numerator)==false & denominator<1000){
        numerator*=10
        denominator*=10
      }
    }

    else {
      numerator=fraction
      denominator=1
      var slash_index=0
      for (var k=0; k<fraction.length; k++){
        if ('-0123456789'.includes(fraction[k])==false){
          slash_index=k}
      }

      if (slash_index>0){
        numerator=fraction.substring(0,slash_index)
        denominator=fraction.substring(slash_index+1,fraction.length)
      }

      numerator=parseFloat(numerator)
      denominator=parseFloat(denominator)
      if (isNaN(numerator) || isNaN(denominator)){
        denominator=0}

      if (denominator<0){
        denominator*=-1
        numerator*=-1
      }
    }
    return([numerator, denominator])
  }

  function sum(X,i,j){
    var s=0
    for (var k=i; k<j; k++){
      s+=X[k]
    }
    return(s)
  }

  // This function returns a randomly generated rational number within a fixed range
  function randrat(){
    var num=Math.round(10*(Math.random()*Math.random()-0.2))
    var den=Math.ceil(5*(Math.random()*Math.random()))
    return([num,den])
  }

  function set(complexity){
    Pivots=[]

    if (Math.random()>0.1){
      Pivots.push(1)}
    else{
      Pivots.push(0)}

    for (var j=1; j<numCols-1; j++){
      if (Math.random()>0.3){
        Pivots.push(1)}
      else{
        Pivots.push(0)}
    }
    if (Math.random()>1){
      Pivots.push(1)}
    else{
      Pivots.push(0)}

    var Matrix=[]
    for (var i=0; i<numRows; i++){
      Matrix.push([])
      for (var j=0; j<numCols; j++){
        if (sum(Pivots,0,j+1)<i+1){
          Matrix[i].push([0,1])}
        if (sum(Pivots,0,j+1)==i+1 && Pivots[j]==1){
          Matrix[i].push([1,1])}
        if (sum(Pivots,0,j)>=i+1){
          if (Pivots[j]==1){
            Matrix[i].push([0,1])}
          if (Pivots[j]==0){
            let r=randrat()
            Matrix[i].push(randrat())
          }
        }
      }
    }

    Initial=[]
    for (var m=0; m<Matrix.length; m++){
      Initial.push([])
      for (var n=0; n<Matrix[m].length; n++){
        Initial[m].push(simplify(Matrix[m][n]))
      }
    }

    //set rank
    for (j=0; j<complexity; j++){
      //Switch 2 rows
      if (Math.random()<0.5){
          m=Math.floor(numRows*Math.random())
          n=Math.floor(numRows*Math.random())
          var Row1=Matrix[m]
          var Row2=Matrix[n]
          Matrix[m]=Row2
          Matrix[n]=Row1
      }

      //Multiply row by integer
      if (Math.random()<0.5){
        m=Math.floor(numRows*Math.random())
        c=Math.round(10*Math.random())-5
        if (c!=0){
          for (k=0; k<numCols; k++){
            Matrix[m][k]=simplify([c*Matrix[m][k][0],Matrix[m][k][1]])
          }
        }
      }

      //Divide row by positive integer
      if (Math.random()<0.3){
        m=Math.floor(numRows*Math.random())
        c=Math.ceil(numRows*Math.random())
        for (k=0; k<numCols; k++){
          Matrix[m][k]=simplify([Matrix[m][k][0],c*Matrix[m][k][1]])
        }
      }

      //Add one row to another
      if (Math.random()<0.9){
        m=Math.floor(numRows*Math.random())
        n=Math.floor(numRows*Math.random())
        for (k=0; k<numCols; k++){
          var t0=Matrix[m][k][0]*Matrix[n][k][1]+Matrix[m][k][1]*Matrix[n][k][0]
          var t1=Matrix[m][k][1]*Matrix[n][k][1]
          Matrix[n][k]=simplify([t0,t1])
        }
      }
    }

    var Entries=get_entries()

    for (p=0; p<numRows; p++){
      for (q=0; q<numCols; q++){
        if (Matrix[p][q][1]==1 || Matrix[p][q][0]==0){
          Entries[p][q].innerHTML=Matrix[p][q][0]}    
        if (Matrix[p][q][1]!=1 && Matrix[p][q][0]!=0){
          Entries[p][q].innerHTML=Matrix[p][q][0]+'&frasl;'+Matrix[p][q][1]}
    }
    }

    pivDex=[]

    for (var j=0; j<Pivots.length;j++){
      if (Pivots[j]==1){
        pivDex.push(j)}
    }

    let r=Math.random()
    for (var k=0; k<pivDex.length; k++){
      if (r>k/pivDex.length && r<(k+1)/pivDex.length){
        PIV= pivDex[k]}
    }

    if (1==2){
      q=document.getElementById("question")
      q.innerHTML='If we know that '
      for (var u=PIV+1; u<Pivots.length; u++){
        Ran=randrat()

        var n0=Ran[0]
        var n1=Ran[1]
        lcm=1
        for (m=0; m<n1+1; m++){
          if (Number.isInteger(n1/m)==true && Number.isInteger(n0/m)==true){
            lcm=m}
        }
        n0/=lcm
        n1/=lcm   

        Ran=[n0,n1]

        if (Ran[1]==1 || Ran[0]==0){
          q.innerHTML+=variables[u]+"="+Ran[0]+", "}
        if (Ran[1] !=1 && Ran[0]!=0){
          q.innerHTML+=variables[u]+"="+Ran[0]+"&frasl;"+ Ran[1]+', '}
      }

      q.innerHTML+=" then find the value of  "+variables[PIV]+'.'
    }
  }

  function write_equations(){
    Entries=get_entries()

    Colors=[]
    for (var i=0; i<numRows; i++){
      Colors.push(document.getElementById(colorList[i]+"tip").style.backgroundColor)
    }

    Eq_el=document.getElementById("equations")
    Eq_list=[]

    for (i=0; i<numRows; i++){
      eq=''
      for (j=0; j<numCols-1; j++){
        if (Entries[i][j].innerHTML=='1'){
          eq+='+'+variables[j]}
        if (Entries[i][j].innerHTML=='-1'){
        eq+='-'+variables[j]}
        if (Entries[i][j].innerHTML!='-1' && Entries[i][j].innerHTML!='0' && Entries[i][j].innerHTML!='1'){
          if (Entries[i][j].innerHTML[0]=='-'){
            eq+=Entries[i][j].innerHTML+variables[j]}
          if (Entries[i][j].innerHTML[0]!='-'){
            eq+='+'+Entries[i][j].innerHTML+variables[j]}
        }
      }
      eq+='='+Entries[i][numCols-1].innerHTML
      if (eq[0]=='+'){
        eq=' '+eq.substring(1,eq.length)}
      if (eq[0]=='='){
        eq=''}

      Eq_list.push(eq)
    }
      
    while(Eq_el.firstChild){
      Eq_el.removeChild(Eq_el.firstChild)
    }
    for (i=0; i<numRows; i++){
      var new_eq = document.createElement('div');
      new_eq.style.position='absolute'
      new_eq.style.width='260px'
      new_eq.style.height='30px'
      new_eq.style.fontSize='20px'
      new_eq.innerHTML=Eq_list[i]
      new_eq.style.top=15+75*i+"px"
      new_eq.style.left="50px"
      new_eq.style.color=Colors[i]
      //new_eq.style.textShadow='white 0.1em 0.1em 0.2em'
      Eq_el.appendChild(new_eq)
    }
  }

  function initialize(){
    equations()
    create_matrix()
    selection()
    set(difficulty)
    reduce()
    write_equations()

    States=[]
    for (var p=0; p<numRows; p++){
    var inp = document.getElementById("in"+(p+1))
    inp.addEventListener("keydown", function (e){
      if (e.code === "Enter"){ 
        mult()}
    })
  }
    for (var ind=0; ind<numRows; ind++){
      mobilize(document.getElementById(colorList[ind]+"tip"))
    }
    //score()
  }

  function record_state(){
    Entries=get_entries()

    COLORS=[]
    for (var j=0; j<numRows; j++){
     COLORS.push(document.getElementById(colorList[j]+"tip").style.backgroundColor)
    }   
    var state=[]
    for (var i=0; i<Entries.length; i++){
      var rowstate=[]
      for (var j=0; j<Entries[i].length; j++){
        rowstate.push(Entries[i][j].innerHTML)
      }
      state.push(rowstate)
  }

    state.push(COLORS)
    States.push(state)
  }

  function revert(){
    S = States[States.length-1]

    var Entries = get_entries()
    for (i=0; i<Entries.length; i++){
      for (j=0; j<Entries[i].length; j++){
        Entries[i][j].innerHTML=S[i][j]
      }
    }
    
    COL=[]
    for (var j=0; j<numRows; j++){
      document.getElementById(colorList[j]+"tip").style.backgroundColor=S[S.length-1][j]
    } 
    States.splice(States.length-1,1)
  }

  function switchAdjacentRows(){
    var i = 1 + parseFloat(document.activeElement.name)
    record_state()
    COL = []
    for (var j=0; j<numRows; j++){
      COL.push(document.getElementById(colorList[j]+"tip"))
    }
    FirstColor = COL[i-1].style.backgroundColor
    SecondColor = COL[i].style.backgroundColor
    
    var Entries = get_entries()
    First = Entries[i-1]
    Second = Entries[i]
    
    var FirstHTML = []
    var SecondHTML = []
    for (var j=0; j<numCols; j++){
      FirstHTML.push(First[j].innerHTML)
      SecondHTML.push(Second[j].innerHTML)
    }
    for (var j=0; j<numCols; j++){
      First[j].innerHTML = SecondHTML[j]
      Second[j].innerHTML = FirstHTML[j]
    }
    
    COL[i-1].style.backgroundColor = SecondColor
    COL[i].style.backgroundColor = FirstColor
    write_equations()
  }

  function mult(){
    var i=1+parseFloat(document.activeElement.name)
    
    record_state()

    constants=[]
    for (var j=0; j<numRows; j++){
      constants.push(document.getElementById("in"+(j+1)))
    }

    var Entries = get_entries()
    Row = Entries[i-1]
    Constant = rationalize(constants[i-1].value)

    if (Constant[1] == 0){
      alert("Please enter a number or fraction, or exact decimal")}
    if (Constant[0] == 0){
      alert("If you multiply an equation by 0 you will lose all the information \
      contained in that equation!")
    }
    if (Constant[0]!=0  && Constant[1]!=0){
      var rowVals = []
      for (var j=0; j<numCols; j++){
        rowVals.push(rationalize(Row[j].innerHTML))
      }

      for (var j=0; j<numCols; j++){
      rowVals[j][0] *= Constant[0]
      rowVals[j][1] *= Constant[1]
      }
    }

    for (var j=0; j<numCols; j++){
      if (rowVals[j][1] == 1){
        Row[j].innerHTML = rowVals[j][0]
      }
      if (rowVals[j][1] != 1){
        Row[j].innerHTML = rowVals[j][0]+"&frasl;"+rowVals[j][1]
      }
    }

    constants[i-1].value = ''
    reduce()
    write_equations()
  }

  function add(Z0,Z1){
    start=99
    end=99

    for (var i=0; i<numRows; i++){
      if (75*i<Z0 && Z0<75*i+50){
        start=i}
      if (75*i<Z1 && Z1<75*i+50){
        end=i}
    }

    if (start!=end){
      record_state()
      var Entries=get_entries()

      constants=[]
      for (var j=0; j<numRows; j++){
        constants.push(document.getElementById("in"+(j+1)))
      }

      if (constants[start].value==''){
        COL=[]
        for (var j=0; j<numRows; j++){
          COL.push( document.getElementById(colorList[j]+"tip"))
        }
        First=Entries[start]
        Second=Entries[end]
        FirstColor=COL[start].style.backgroundColor
        SecondColor=COL[end].style.backgroundColor
        var FirstHTML=[]
        var SecondHTML=[]
        for (var j=0; j<numCols; j++){
          FirstHTML.push(First[j].innerHTML)
          SecondHTML.push(Second[j].innerHTML)
        }
        for (var j=0; j<numCols; j++){
          First[j].innerHTML=SecondHTML[j]
          Second[j].innerHTML=FirstHTML[j]
        }

        COL[start].style.backgroundColor=SecondColor
        COL[end].style.backgroundColor=FirstColor
      }
      if (constants[start].value!=''){
        var C=rationalize(constants[start].value.toString())

        startRow=Entries[start]
        endRow=Entries[end]
        newVals=[]
        for (i=0; i<startRow.length; i++){
          var S=rationalize(startRow[i].innerHTML)
          var E=rationalize(endRow[i].innerHTML)
          newVals.push([C[0]*S[0]*E[1]+E[0]*C[1]*S[1],C[1]*S[1]*E[1]])}

        for (var j=0; j<numCols; j++){
          numer=newVals[j][0]
          denom=newVals[j][1]
          if (denom==1){
            Entries[end][j].innerHTML=numer}
          if (denom!=1){
            Entries[end][j].innerHTML=numer+"&frasl;"+denom}
        }

        constants[start].value=''
        reduce()
      }
      write_equations()
    }
  }
  
  function simplify(n){
    var n0=n[0]
    var n1=n[1]
    var greatestCommonDivisor=1
    for (var m=1; m<n1+1; m++){
      if (Number.isInteger(n1/m)==true && Number.isInteger(n0/m)==true){
        greatestCommonDivisor=m}
    }

    n0/=greatestCommonDivisor
    n1/=greatestCommonDivisor
    return([n0,n1])
  }

  function reduce(){
    var Entries=get_entries()
    for (var i=0; i<Entries.length; i++){
      for (var j=0; j<Entries[i].length; j++){
        var n=rationalize(Entries[i][j].innerHTML)
        var n0=n[0]
        var n1=n[1]
        var lcm=1
        for (var m=1; m<n1+1; m++){
          if (Number.isInteger(n1/m)==true && Number.isInteger(n0/m)==true){
            greatestCommonDivisor=m}
        }

        n0/=greatestCommonDivisor
        n1/=greatestCommonDivisor
        if (n1==1){
          Entries[i][j].innerHTML=n0}
        if (n1!=1){
          Entries[i][j].innerHTML=n0+"&frasl;"+n1}
      }
    }
  }

  function clear(){
    if (window.getSelection){
      window.getSelection().removeAllRanges();}
    else if (document.selection){
      document.selection.empty();}
  }

  function mobilize(tip){
    tip.onmousedown = move

    function move(e) {
      Y0 = e.clientY;
      x0 = e.clientX;
      y0 = e.clientY;
      document.onmousemove = drag;
      document.onmouseup = close;
    }

    function drag(e) {
      dx = e.clientX-x0;
      dy = e.clientY-y0;
      x0 = e.clientX;
      y0 = e.clientY;
      tip.style.left = (tip.offsetLeft + dx) + "px";
      tip.style.top = (tip.offsetTop + dy) + "px";
      clear()
    }
    
    function close(e) {
      document.onmouseup = null;
      document.onmousemove = null;
      for (var v=0; v<numRows; v++){
        document.getElementById(colorList[v]+"tip").style.left="100px";
        document.getElementById(colorList[v]+"tip").style.top=75*v+"px";
      }
      Y1=e.clientY
      ABS=document.getElementById('outer').getBoundingClientRect()
      off=(ABS.top)
      add(Y0-off,Y1-off)
     }  
  }

  const colorList=["royalblue","green","tomato","yellow","orange","sienna"]
  const variables=['a','b','c','d','e','f','g','h']
  numRows=3
  numCols=5
  var Module_Number="11"
  quests=[0,0,0,0,0,0,0,0,0,0,0]
  the_time=Date.now()
  //make_grades(Module_Number)

  difficulty=1
  page=difficulty-1

  initialize()
</script>
</body>
</html>